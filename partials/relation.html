<div ng-include="'./partials/settings.html'"></div>

<div id="maps-wrapper" class="row">
  <div class="col-md-6">
    <div class="panel panel-default">
      <div class="panel-heading" translate>Relation</div>
      <div class="panel-body">
        <h1>{{relationName}}</h1>
        <button class="btn btn-primary" ng-click="saveRelation()">Save</button>
        <tabset>
          <tab heading="members {{members.length}}">
            <div class="form-group">
              <input class="form-control" type="search" ng-model="q"/>
            </div>
            <table class="table table-bordered">
              <tr width="60%">
                <th>actions</th>
                <th>type/ref name</th>
              </tr>
              <tr width="30%" ng-repeat="member in members | filter:q">
                <td>
                  <div style="font-size: 80%" ng-show="member.type === 'relation'">
                    <a target="_blank" ng-href="https://openstreetmap.org/relation/{{member.ref}}" translate>OSM</a>
                    <a target="_blank" ng-href="https://openstreetmap.org/edit?relation={{member.ref}}" translate>iD</a>
                    <a target="_blank" ng-href="http://www.openstreetmap.org/edit?editor=potlatch2&zoom=11&relation={{member.ref}}" translate>Potlatch2</a>
                    <a target="_blank" ng-href="http://localhost:8111/import?url=http://api.openstreetmap.org/api/0.6/relation/{{member.ref}}/full" translate>JOSM</a>
                    <a target="_blank" ng-href="http://osm.virtuelle-loipe.de/history/?type=relation&ref={{member.ref}}" translate>History</a>
                    <a target="_blank" ng-href="http://ra.osmsurround.org/analyze.jsp?relationId={{member.ref}}" translate>Analyse</a>
                    <a target="_blank" ng-href="http://api.openstreetmap.fr/analyse/cgi-bin/index.py?relation={{member.ref}}" translate>Analyse fr</a>
                    <a target="_blank" ng-href="http://osmrm.openstreetmap.de/relation.jsp?id={{member.ref}}" translate>Manage</a>
                    <a target="_blank" ng-href="http://osmrm.openstreetmap.de/gpx.jsp?relation={{member.ref}}" translate>GPX</a>
                  </div>

                  <button  ng-show="member.type !== 'relation'" ng-class="{btn: 1, 'btn-xs': 1, 'btn-default': member.ref !== displayedMember, 'btn-primary': member.ref === displayedMember}" ng-click="displayMember(member)">
                    <i class="fa fa-map-marker"></i>
                  </button>

                  <div class="btn-group">
                    <button ng-disabled="$first" class="btn btn-default" ng-click="moveMemberUp(member)">
                      <i class="fa fa-arrow-circle-o-up"></i>
                    </button>
                    <button ng-disabled="$last" class="btn btn-default" ng-click="moveMemberDown(member)">
                      <i class="fa fa-arrow-circle-o-down"></i>
                    </button>
                    <button class="btn btn-danger" ng-click="removeMemberFromRelation(member)">
                      <i class="fa fa-trash-o"></i>
                    </button>
                  </div>
                </td>
                <td>
                  <div ng-if="member.type === 'relation'">
                    relation/
                    <a class="btn btn-default" ng-click="setCurrentRelation(member)">{{member.ref}}</a> {{member.name}}
                  </div>
                  <div ng-if="member.type !== 'relation'">
                    {{member.type}}/
                    <a target="_blank" href="http://www.openstreetmap.org/{{member.type}}/{{member.ref}}">{{member.ref}}</a> {{member.name}}
                  </div>
                </td>
              </tr>
            </table>
          </tab>
          <tab heading="tags {{tags.length}}">
            <table class="table table-bordered">
              <tr>
                <th>key</th>
                <th>value</th>
              </tr>
              <tr ng-repeat="tag in tags">
                <td>{{tag.k}}</td>
                <td>
                  <input class="form-control" type="text" ng-model="tag.v"/>
                </td>
              </tr>
            </table>
          </tab>
        </tabset>
      </div>
    </div>

  </div>
  <div class="col-md-6" ng-controller="LeafletController">
    <leaflet center="center" markers="markers" layers="layers" width="100%" height="600" geojson="leafletGeojson"></leaflet>

    <table class="table table-bordered">
      <tr>
        <th>Categories</th>
        <th>Actions</th>
      </tr>
<!--
      <tr ng-show="zoomLevel > 15">
        <td>Loading data (OSM API)</td>
        <td>
          <a class="btn btn-default" ng-click="loadOSMNodes()" translate>Load nodes</a>
          <a class="btn btn-default" ng-click="loadOSMWays()" translate>Load ways</a>
          <a class="btn btn-default" ng-click="loadOSMBusStop()" translate>Load bus stop</a>
        </td>
      </tr>
    -->
      <tr ng-show="currentNode">
        <td>Selected item</td>
        <td>
          <button ng-show="currentNode" class="btn btn-primary btn-lg" ng-click="addNodeToRelation(currentNode)">Add {{currentNode.id}} to relation</button>
        </td>
      </tr>
      <tr>
        <td>Overpass API</td>
        <td>
          <div class="btn-group">
            <a class="btn btn-default" ng-click="loadOverpassWays()" translate>display ways</a>
            <a class="btn btn-default" ng-click="loadOverpassBusStop()" translate>display bus stop</a>
            <a class="btn btn-danger" ng-show="overpassLayer" ng-click="removeOverpassLayer()">hide items</a>
          </div>
        </td>
      </tr>
    </table>


    <br/>
    <div class="panel panel-default">
      <div class="panel-heading">DEBUG</div>
      <div class="panel-body">
        <tabset>
          <tab heading="relation (xml)">
            <pre>{{relationXML}}</pre>
          </tab>
          <tab heading="relation full (xml)">
            <pre>{{relationXMLFull}}</pre>
          </tab>
          <tab heading="relation output (xml)">
            <pre>{{relationXMLOutput}}</pre>
          </tab>
          <tab heading="currentNode">
            <p>For debug purpose</p>
            <pre>{{currentNode}}</pre>
          </tab>
        </tabset>
      </div>
    </div>
  </div>

</div>
